cmake_minimum_required(VERSION 3.22.0)
project(libLunaScript CXX)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_CXX_EXTENSIONS ON)

if (CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
    set(CMAKE_COMPILER_NUMBER 0)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
    set(CMAKE_COMPILER_NUMBER 1)
elseif (CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
    set(CMAKE_COMPILER_NUMBER 2)
else()
    message(FATAL_ERROR "compiler not supported")
endif()

if(${CMAKE_SYSTEM_NAME} MATCHES "Linux")
    set(CMAKE_SYSTEM_NUMBER 0)
    message(INFO " - building for Linux....")
elseif(${CMAKE_SYSTEM_NAME} MATCHES "WindowsStore")
    set(CMAKE_SYSTEM_NUMBER 1)
    message(INFO " -  building for WindowsStore....")
elseif(${CMAKE_SYSTEM_NAME} MATCHES "Windows")
    set(CMAKE_SYSTEM_NUMBER 2)
    message(INFO " - building for Windows....")
else()
    message(FATAL_ERROR "system not supported")
endif()
configure_file(src/Cmake.h.in ../src/Cmake.h @ONLY)

set(compiler_source src/compiler/Lexer.cpp src/compiler/CodeGen.cpp)

add_library(libLunaScript SHARED ${compiler_source})
set_property(TARGET libLunaScript PROPERTY CXX_STANDARD 20)
target_include_directories(libLunaScript PRIVATE ${PROJECT_SOURCE_DIR}/include STATIC)
target_compile_options(libLunaScript PRIVATE -Wall -Wextra -Werror)